!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).videojs)}(this,(function(e){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=r(e),i=-1,a={markerStyle:{width:"7px","border-radius":"30%","background-color":"red",top:"0em"},markerTip:{display:!0,text:function(e){return e.text},time:function(e){return e.time}},breakOverlay:{display:!0,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},markers:[]},s=function(e){var r;try{r=e.getBoundingClientRect()}catch(e){r={top:0,bottom:0,left:0,width:0,height:0,right:0}}return r},n=function(){function e(e,r){var s=this;void 0===r&&(r={}),this.player_=e,this.options_=t.default.mergeOptions(a,r),this.markersMap_={},this.currentMarkerIndex_=i,this.markerTip_=null,this.breakOverlay_=null,this.overlayIndex_=i,this.markers=[],this.player_.on("loadedmetadata",(function(){s.initialize()}))}var r=e.prototype;return r.sortMarkers=function(){var e=this;this.markers.sort((function(r,t){return e.options_.markerTip.time(r)-e.options_.markerTip.time(t)}))},r.getPosition=function(e){return this.options_.markerTip.time(e)/this.player_.duration()*100},r.addMarkers=function(e){var r=this;e.forEach((function(e){var t;e.key=(t=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)}))),r.player_.el().querySelector(".vjs-progress-holder").appendChild(r.createMarkerEl(e)),r.markersMap_[e.key]=e,r.markers.push(e)})),this.sortMarkers()},r.createMarkerEl=function(e){var r=this,i=t.default.dom.createEl("div",{},{"data-marker-key":e.key,"data-marker-time":this.options_.markerTip.time(e)});return this.setMarkerElStyle(e,i),i.addEventListener("click",(function(){var t=i.getAttribute("data-marker-key");r.player_.currentTime(r.options_.markerTip.time(r.markersMap_[t])),r.player_.trigger("marker-click",e)})),this.options_.markerTip.display&&this.registerMarkerTipHandler(i),i},r.updateMarkers=function(e){var r=this;this.markers.forEach((function(t){var i=r.player_.el().querySelector(".vjs-marker[data-marker-key='"+t.key+"']"),a=r.options_.markerTip.time(t);(e||i.getAttribute("data-marker-time")!==a)&&(setMarkerElStyle(t,i),i.setAttribute("data-marker-time",a))})),this.sortMarkers()},r.removeMarkers=function(e){var r=this;this.breakOverlay_&&(this.overlayIndex_=i,this.breakOverlay_.style.visibility="hidden"),this.currentMarkerIndex_=i;var t=[];e.forEach((function(e){var i=r.markers[e];if(i){delete r.markersMap_[i.key],t.push(e);var a=r.player_.el().querySelector(".vjs-marker[data-marker-key='"+i.key+"']");a&&a.parentNode.removeChild(a)}})),t.reverse(),t.forEach((function(e){r.markers.splice(e,1)})),this.sortMarkers()},r.setMarkerElStyle=function(e,r){var t=this;r.className="vjs-marker "+(e.class||""),Object.keys(this.options_.markerStyle).forEach((function(e){r.style[e]=t.options_.markerStyle[e]}));var i=e.time/this.player_.duration();if((i<0||i>1)&&(r.style.display="none"),r.style.left=this.getPosition(e)+"%",e.duration)r.style.width=e.duration/this.player_.duration()*100+"%",r.style.marginLeft="0px";else{var a=s(r);r.style.marginLeft=a.width/2+"px"}},r.registerMarkerTipHandler=function(e){var r=this;e.addEventListener("mouseover",(function(){var t=r.markersMap_[e.getAttribute("data-marker-key")];if(r.markerTip_){r.options_.markerTip.html?r.markerTip_.querySelector(".vjs-tip-inner").innerHTML=r.options_.markerTip.html(t):r.markerTip_.querySelector(".vjs-tip-inner").innerText=r.options_.markerTip.text(t),r.markerTip_.style.left=r.getPosition(t)+"%";var i=s(r.markerTip_),a=s(e);r.markerTip_.style.marginLeft=-parseFloat(i.width/2)+parseFloat(a.width/4)+"px",r.markerTip_.style.visibility="visible"}})),e.addEventListener("mouseout",(function(){r.markerTip_&&(r.markerTip_.style.visibility="hidden")}))},r.initializeMarkerTip=function(){this.markerTip_=t.default.dom.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-inner'></div>"}),this.player_.el().querySelector(".vjs-progress-holder").appendChild(this.markerTip_)},r.updateBreakOverlay=function(){if(this.options_.breakOverlay.display&&!(this.currentMarkerIndex_<0)){var e=this.player_.currentTime(),r=this.markers[this.currentMarkerIndex_],t=this.options_.markerTip.time(r),a=r.overlayText;e>=t&&e<=t+this.options_.breakOverlay.displayTime&&a?(this.overlayIndex_!==this.currentMarkerIndex_&&(this.overlayIndex_=this.currentMarkerIndex_,this.breakOverlay_&&(this.breakOverlay_.querySelector(".vjs-break-overlay-text").innerHTML=this.options_.breakOverlay.text(r))),this.breakOverlay_&&(this.breakOverlay_.style.visibility="visible")):(this.overlayIndex_=i,this.breakOverlay_&&(this.breakOverlay_.style.visibility="hidden"))}},r.initializeOverlay=function(){var e=this;this.breakOverlay_=t.default.dom.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(this.options_.breakOverlay.style).forEach((function(r){e.breakOverlay_&&(e.breakOverlay_.style[r]=e.options_.breakOverlay.style[r])})),this.player_.el().appendChild(this.breakOverlay_),this.overlayIndex_=i},r.onUpdateMarker=function(){var e=this;if(this.markers.length){var r=function(r){return r<e.markers.length-1?e.options_.markerTip.time(e.markers[r+1]):e.player_.duration()},t=this.player_.currentTime(),a=i;if(this.currentMarkerIndex_!==i){var s=r(this.currentMarkerIndex_);if(t>=this.options_.markerTip.time(this.markers[this.currentMarkerIndex_])&&t<s)return;if(this.currentMarkerIndex_===this.markers.length-1&&t===this.player_.duration())return}if(t<this.options_.markerTip.time(this.markers[0]))a=i;else for(var n=0;n<this.markers.length;n++){var o=r(n);if(t>=this.options_.markerTip.time(this.markers[n])&&t<o){a=n;break}}a!==this.currentMarkerIndex_&&(a!==i&&this.player_.trigger("marker-reached",{index:a,marker:this.markers[a]}),this.currentMarkerIndex_=a)}},r.onTimeUpdate=function(){this.onUpdateMarker(),this.updateBreakOverlay()},r.initialize=function(){var e=this;this.options_.markerTip.display&&this.initializeMarkerTip(),this.removeAll(),this.addMarkers(this.options_.markers),this.options_.breakOverlay.display&&this.initializeOverlay(),this.onTimeUpdate(),this.player_.on("timeupdate",(function(){return e.onTimeUpdate()})),this.player_.off("loadedmetadata")},r.getMarkers=function(){return this.markers},r.next=function(){for(var e=this.player_.currentTime(),r=0;r<this.markers.length;r++){var t=this.options_.markerTip.time(this.markers[r]);if(t>e){this.player_.currentTime(t);break}}},r.prev=function(){for(var e=this.player_.currentTime(),r=this.markers.length-1;r>=0;r--){var t=this.options_.markerTip.time(this.markers[r]);if(t+.5<e)return void this.player_.currentTime(t)}},r.add=function(e){this.addMarkers(e)},r.remove=function(e){this.removeMarkers(e)},r.removeAll=function(){for(var e=[],r=0;r<this.markers.length;r++)e.push(r);this.removeMarkers(e)},r.updateTime=function(e){this.updateMarkers(e)},r.reset=function(e){this.removeAll(),addMarkers(e)},r.destroy=function(){this.removeAll(),this.breakOverlay_&&this.breakOverlay_.remove(),this.markerTip_&&this.markerTip_.remove(),this.player_.off("timeupdate",this.updateBreakOverlay),this.player_.off("timeupdate",this.onTimeUpdate),delete this.player_.marker},e}();t.default.registerPlugin("setMarkers",(function(e){var r=this.player_;r.markers=new n(r,e)})),t.default.hook("setup",(function(e){var r=e.options_.markerOptions;e.setMarkers(r)}))}));
