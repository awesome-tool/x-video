import t from"video.js";function e(){return e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},e.apply(this,arguments)}function n(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}function i(t,e){return i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i(t,e)}var r=function(t){function i(n,i){var r;return(r=t.call(this,n,e({},i,{name:"SubtitleSettingMenuItem",label:"Subtitles",icon:"vjs-icon-subtitles",entries:n.options_.subtitles||[]}))||this).addClass("vjs-setting-subtitles"),n.on("subtitles",(function(t,n){var i=!0,o=n.map((function(t,n){return i=!i||!t.default,e({},t,{value:n})}));r.setEntries([].concat(o,[{label:"Close Subtitles",value:-1,default:i}])),r.show()})),n.on("subtitlechange",(function(t,e){var n=e.index;-1===n&&(n=r.entries.length-1),r.select(n),r.update(n)})),r}return n(i,t),i.prototype.onChange=function(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];(e=t.prototype.onChange).call.apply(e,[this].concat(i)),this.player_.subtitles().pick(this.selected.value)},i}(t.getComponent("SettingOptionItem"));t.getComponent("SettingMenuButton").prototype.options_.entries.push("SubtitleSettingMenuItem"),t.registerComponent("SubtitleSettingMenuItem",r);var o=function(t){function i(e,n){var i,r;(i=t.call(this,e,n)||this).flag=null,i.track=null;var o=function(){clearTimeout(r);var t=i.values(),n=t.find((function(t){return"showing"===t.mode}))||{},o=n.label||n.id||-1;r=setTimeout((function(){i.flag!==o&&(i.flag=o,e.trigger("subtitlechange",{index:t.indexOf(n),label:n.label||""}))}),10)};return e.textTracks().on("change",o),e.on("dispose",(function(){e.textTracks().off("change",o)})),i}n(i,t);var r=i.prototype;return r.values=function(){for(var t=this.player.textTracks(),e=[],n=0;n<t.length;n++)"subtitles"===t[n].kind&&e.push(t[n]);return e},r.load=function(t){void 0===t&&(t=[]);var n=this.player;if(t&&t.length){this.remove();var i=-1,r=[],o=t.map((function(t,o){var s=Object.assign({},t),a=n.addRemoteTextTrack(e({},s,{default:!1}),!0);return a.track.mode="hidden",r.push(a),-1===i&&!0===s.default?i=o:s.default=!1,s}));-1!==i&&(this.flag=o[i].label,this.track=r[i].track,this.track.mode="showing"),n.trigger("subtitles",o)}return this},r.remove=function(){var t=this;return this.values().forEach((function(e){t.player.removeRemoteTextTrack(e)})),this},r.pick=function(t){var e=this.values()[t];return e?(this.track&&(this.track.mode="disabled"),this.track=e,this.track.mode="showing"):this.track&&(this.track.mode="disabled"),this},i}(t.getPlugin("plugin"));t.hook("setup",(function(t){t.ready((function(){var e=t.options_.subtitles;e&&e.length&&t.subtitles().load(e)}))})),t.registerPlugin("subtitles",o);
